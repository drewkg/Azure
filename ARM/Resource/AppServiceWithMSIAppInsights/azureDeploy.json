{
	"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"application": {
			"type": "string",
			"defaultValue": "demo",
			"minLength": 1,
			"maxLength": 15,
			"metadata": {
				"description": "The application prefix, used within resource naming to ensure grouping of resources within the Azure portal."
			}
		},
		"environment": {
			"type": "string",
			"defaultValue": "ObjInt",
			"metadata": {
				"description": "The environment tag to provide unique resources between test / production and ephemeral environments."
			}
		},
		"location": {
			"type": "string",
			"defaultValue": "[resourceGroup().location]",
			"metadata": {
				"description": "The location of the resources created, excluding 'Global', defaults to the resource group location."
			}
		}
	},
	"variables": {
		"environment": "[parameters('environment')]",
		"applicationInsightsName": "[format('{0}-{1}-{2}-appi', parameters('application'), variables('environment'), parameters('location'))]",
		"appServiceName": "[format('{0}-{1}-{2}-asp', parameters('application'), variables('environment'), parameters('location'))]",
		"appServicePlanName": "[format('{0}-{1}-{2}-as', parameters('application'), variables('environment'), parameters('location'))]"
	},
	"resources": [
		{
			"name": "[variables('applicationInsightsName')]",
			"type": "Microsoft.Insights/components",
			"apiVersion": "2020-02-02",
			"location": "[parameters('Location')]",
			"kind": "web",
			"properties": {
				"Application_Type": "web",
				"Flow_Type": "Bluefield",
				"Request_Source": "rest",
				"publicNetworkAccessForIngestion": "Enabled",
				"publicNetworkAccessForQuery": "Enabled"
			}
		},
		{
			"name": "ApplicationInsightsDashboard",
			"type": "Microsoft.Resources/deployments",
			"apiVersion": "2024-03-01",
			"dependsOn": [
				"[variables('applicationInsightsName')]"
			],
			"properties": {
				"mode": "Incremental",
				"expressionEvaluationOptions": {
					"scope": "Inner"
				},
				"template": {
					"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
					"contentVersion": "1.0.0.0",
					"parameters": {
						"applicationInsightsDashboardName": {
							"type": "string",
							"metadata": {
								"description": "The resource name for the Application Insights dashboard."
							}
						},
						"applicationInsightsName": {
							"type": "string",
							"metadata": {
								"description": "The resource name for the Application Insights instance."
							}
						},
						"Location": {
							"type": "string",
							"metadata": {
								"description": "The location of the resources created, excluding 'Global'."
							}
						}
					},
					"resources": [
						{
							"name": "[parameters('applicationInsightsDashboardName')]",
							"type": "Microsoft.Portal/dashboards",
							"apiVersion": "2020-09-01-preview",
							"location": "[parameters('Location')]",
							"properties": {
                "lenses": [
                  {
                    "order": 0,
                    "parts": [
                      {
                        "position": {
                          "x": 0,
                          "y": 0,
                          "rowSpan": 1,
                          "colSpan": 2
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "id",
                              "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                            },
                            {
                              "name": "Version",
                              "value": "1.0"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                          "asset": {
                            "idInputName": "id",
                            "type": "ApplicationInsights"
                          },
                          "defaultMenuItemId": "overview"
                        }
                      },
                      {
                        "position": {
                          "x": 2,
                          "y": 0,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "Version",
                              "value": "1.0"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                          "asset": {
                            "idInputName": "ComponentId",
                            "type": "ApplicationInsights"
                          },
                          "defaultMenuItemId": "ProactiveDetection"
                        }
                      },
                      {
                        "position": {
                          "x": 3,
                          "y": 0,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "ResourceId",
                              "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                          "asset": {
                            "idInputName": "ComponentId",
                            "type": "ApplicationInsights"
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 4,
                          "y": 0,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "TimeContext",
                              "value": {
                                "durationMs": 86400000,
                                "isInitialTime": true,
                                "grain": 1,
                                "useDashboardTimeRange": false
                              }
                            },
                            {
                              "name": "Version",
                              "value": "1.0"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                          "asset": {
                            "idInputName": "ComponentId",
                            "type": "ApplicationInsights"
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 5,
                          "y": 0,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "TimeContext",
                              "value": {
                                "durationMs": 86400000,
                                "isInitialTime": true,
                                "grain": 1,
                                "useDashboardTimeRange": false
                              }
                            },
                            {
                              "name": "ConfigurationId",
                              "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                          "asset": {
                            "idInputName": "ComponentId",
                            "type": "ApplicationInsights"
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 0,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 3
                        },
                        "metadata": {
                          "inputs": [],
                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                          "settings": {
                            "content": {
                              "settings": {
                                "content": "# Usage",
                                "title": "",
                                "subtitle": ""
                              }
                            }
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 3,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "TimeContext",
                              "value": {
                                "durationMs": 86400000,
                                "isInitialTime": true,
                                "grain": 1,
                                "useDashboardTimeRange": false
                              }
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                          "asset": {
                            "idInputName": "ComponentId",
                            "type": "ApplicationInsights"
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 4,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 3
                        },
                        "metadata": {
                          "inputs": [],
                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                          "settings": {
                            "content": {
                              "settings": {
                                "content": "# Reliability",
                                "title": "",
                                "subtitle": ""
                              }
                            }
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 7,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ResourceId",
                              "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                            },
                            {
                              "name": "DataModel",
                              "value": {
                                "version": "1.0.0",
                                "timeContext": {
                                  "durationMs": 86400000,
                                  "isInitialTime": false,
                                  "grain": 1,
                                  "useDashboardTimeRange": false
                                }
                              },
                              "isOptional": true
                            },
                            {
                              "name": "ConfigurationId",
                              "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                          "isAdapter": true,
                          "asset": {
                            "idInputname": "ResourceId",
                            "type": "ApplicationInsights"
                          },
                          "defaultMenuItemId": "failures"
                        }
                      },
                      {
                        "position": {
                          "x": 8,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 3
                        },
                        "metadata": {
                          "inputs": [],
                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                          "settings": {
                            "content": {
                              "settings": {
                                "content": "# Responsiveness\r\n",
                                "title": "",
                                "subtitle": ""
                              }
                            }
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 11,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ResourceId",
                              "value": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                            },
                            {
                              "name": "DataModel",
                              "value": {
                                "version": "1.0.0",
                                "timeContext": {
                                  "durationMs": 86400000,
                                  "isInitialTime": false,
                                  "grain": 1,
                                  "useDashboardTimeRange": false
                                }
                              },
                              "isOptional": true
                            },
                            {
                              "name": "ConfigurationId",
                              "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                          "isAdapter": true,
                          "asset": {
                            "idInputname": "ResourceId",
                            "type": "ApplicationInsights"
                          },
                          "defaultMenuItemId": "performance"
                        }
                      },
                      {
                        "position": {
                          "x": 12,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 3
                        },
                        "metadata": {
                          "inputs": [],
                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                          "settings": {
                            "content": {
                              "settings": {
                                "content": "# Browser",
                                "title": "",
                                "subtitle": ""
                              }
                            }
                          }
                        }
                      },
                      {
                        "position": {
                          "x": 15,
                          "y": 1,
                          "rowSpan": 1,
                          "colSpan": 1
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "ComponentId",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "MetricsExplorerJsonDefinitionId",
                              "value": "BrowserPerformanceTimelineMetrics"
                            },
                            {
                              "name": "TimeContext",
                              "value": {
                                "durationMs": 86400000,
                                "isInitialTime": false,
                                "grain": 1,
                                "useDashboardTimeRange": false
                              }
                            },
                            {
                              "name": "CurrentFilter",
                              "value": {
                                "eventTypes": [
                                  4,
                                  1,
                                  3,
                                  5,
                                  2,
                                  6,
                                  13
                                ],
                                "typeFacets": {},
                                "isPermissive": false
                              }
                            },
                            {
                              "name": "id",
                              "value": {
                                "Name": "[parameters('applicationInsightsName')]",
                                "SubscriptionId": "[subscription().subscriptionId]",
                                "ResourceGroup": "[resourceGroup().name]"
                              }
                            },
                            {
                              "name": "Version",
                              "value": "1.0"
                            }
                          ],
                          "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                          "asset": {
                            "idInputname": "ComponentId",
                            "type": "ApplicationInsights"
                          },
                          "defaultMenuItemId": "browser"
                        }
                      },
                      {
                        "position": {
                          "x": 0,
                          "y": 2,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "sessions/count",
                                      "aggregationtype": 5,
                                      "namespace": "microsoft.insights/components/kusto",
                                      "metricVisualization": {
                                        "displayname": "Sessions",
                                        "color": "'#47BDF5"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "users/count",
                                      "aggregationtype": 5,
                                      "namespace": "microsoft.insights/components/kusto",
                                      "metricVisualization": {
                                        "displayname": "Users",
                                        "color": "#7E58FF"
                                      }
                                    }
                                  ],
                                  "title": "Unique sessions and users",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  },
                                  "openBladeOnClick": {
                                    "openBlade": true,
                                    "destinationBlade": {
                                      "extensionname": "HubsExtension",
                                      "bladename": "ResourceMenuBlade",
                                      "parameters": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]",
                                        "menuid": "segmentationUsers"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 4,
                          "y": 2,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "requests/failed",
                                      "aggregationtype": 7,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Failed requests",
                                        "color": "#EC008C"
                                      }
                                    }
                                  ],
                                  "title": "Failed requests",
                                  "visualization": {
                                    "charttype": 3,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  },
                                  "openBladeOnClick": {
                                    "openBlade": true,
                                    "destinationBlade": {
                                      "extensionname": "HubsExtension",
                                      "bladename": "ResourceMenuBlade",
                                      "parameters": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]",
                                        "menuid": "failures"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 8,
                          "y": 2,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "requests/duration",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Server response time",
                                        "color": "#00BCF2"
                                      }
                                    }
                                  ],
                                  "title": "Server response time",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  },
                                  "openBladeOnClick": {
                                    "openBlade": true,
                                    "destinationBlade": {
                                      "extensionname": "HubsExtension",
                                      "bladename": "ResourceMenuBlade",
                                      "parameters": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]",
                                        "menuid": "performance"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 12,
                          "y": 2,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "browserTimings/networkDuration",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Page load network connect time",
                                        "color": "#7E58FF"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "browserTimings/processingDuration",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Client processing time",
                                        "color": "#44F1C8"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "browserTimings/sendDuration",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Send request time",
                                        "color": "#EB9371"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "browserTimings/receiveDuration",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Receiving response time",
                                        "color": "#0672F1"
                                      }
                                    }
                                  ],
                                  "title": "Average page load time breakdown",
                                  "visualization": {
                                    "charttype": 3,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 0,
                          "y": 5,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "availabilityResults/availabilityPercentage",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Availability",
                                        "color": "#47BDF5"
                                      }
                                    }
                                  ],
                                  "title": "Average availability",
                                  "visualization": {
                                    "charttype": 3,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  },
                                  "openBladeOnClick": {
                                    "openBlade": true,
                                    "destinationBlade": {
                                      "extensionname": "HubsExtension",
                                      "bladename": "ResourceMenuBlade",
                                      "parameters": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]",
                                        "menuid": "availability"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 4,
                          "y": 5,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "exceptions/server",
                                      "aggregationtype": 7,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Server exceptions",
                                        "color": "#47BDF5"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "dependencies/failed",
                                      "aggregationtype": 7,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Dependency failures",
                                        "color": "#7E58FF"
                                      }
                                    }
                                  ],
                                  "title": "Server exceptions and Dependency failures",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 8,
                          "y": 5,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "performanceCounters/processorCpuPercentage",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Processor time",
                                        "color": "#47BDF5"
                                      }
                                    },
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "performanceCounters/processCpuPercentage",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Process CPU",
                                        "color": "#7E58FF"
                                      }
                                    }
                                  ],
                                  "title": "Average processor and process CPU utilization",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 12,
                          "y": 5,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "exceptions/browser",
                                      "aggregationtype": 7,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Browser exceptions",
                                        "color": "#47BDF5"
                                      }
                                    }
                                  ],
                                  "title": "Browser exceptions",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 0,
                          "y": 8,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "availabilityResults/count",
                                      "aggregationtype": 7,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Availability test results count",
                                        "color": "#47BDF5"
                                      }
                                    }
                                  ],
                                  "title": "Availability test results count",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 4,
                          "y": 8,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "performanceCounters/processIOBytesPerSecond",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Process IO rate",
                                        "color": "#47BDF5"
                                      }
                                    }
                                  ],
                                  "title": "Average process I/O rate",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      },
                      {
                        "position": {
                          "x": 8,
                          "y": 8,
                          "rowSpan": 3,
                          "colSpan": 4
                        },
                        "metadata": {
                          "inputs": [
                            {
                              "name": "options",
                              "value": {
                                "chart": {
                                  "metrics": [
                                    {
                                      "resourcemetadata": {
                                        "id": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
                                      },
                                      "name": "performanceCounters/memoryAvailableBytes",
                                      "aggregationtype": 4,
                                      "namespace": "microsoft.insights/components",
                                      "metricVisualization": {
                                        "displayname": "Available memory",
                                        "color": "#47BDF5"
                                      }
                                    }
                                  ],
                                  "title": "Average available memory",
                                  "visualization": {
                                    "charttype": 2,
                                    "legendVisualization": {
                                      "isVisible": true,
                                      "position": 2,
                                      "hideSubtitle": false
                                    },
                                    "axisVisualization": {
                                      "x": {
                                        "isVisible": true,
                                        "axistype": 2
                                      },
                                      "y": {
                                        "isVisible": true,
                                        "axistype": 1
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "name": "sharedTimeRange",
                              "isOptional": true
                            }
                          ],
                          "type": "Extension/HubsExtension/PartType/MonitorChartPart"
                        }
                      }
                    ]
                  }
                ]
							},
							"tags": {
								"hidden-title": "[concat(parameters('applicationInsightsName'), ' Dashboard')]"
							}
						}
					]
				},
				"parameters": {
					"applicationInsightsDashboardName": {
						"value": "[concat(reference(resourceId('Microsoft.Insights/components', variables('applicationInsightsName')), '2020-02-02', 'Full').properties.AppId, '-dashboard')]"
					},
					"applicationInsightsName": {
						"value": "[variables('applicationInsightsName')]"
					},
					"Location": {
						"value": "[parameters('Location')]"
					}
				}
			}
		},
		{
			"type": "Microsoft.Web/serverfarms",
			"apiVersion": "2024-04-01",
			"name": "[variables('appServicePlanName')]",
			"location": "[parameters('Location')]",
			"sku": {
				"name": "B1",
				"tier": "Basic",
				"size": "B1",
				"family": "B",
				"capacity": 1
			},
			"kind": "app",
			"properties": {
				"perSiteScaling": false,
				"maximumElasticWorkerCount": 1,
				"isSpot": false,
				"reserved": false,
				"isXenon": false,
				"hyperV": false
			}
		},
		{
			"type": "Microsoft.Web/sites",
			"apiVersion": "2024-04-01",
			"name": "[variables('appServiceName')]",
			"location": "[parameters('Location')]",
			"dependsOn": [
				"[variables('appServicePlanName')]"
			],
			"kind": "app",
			"properties": {
				"enabled": true,
				"hostNameSslStates": [
					{
						"name": "[concat(variables('appServiceName'), '.azurewebsites.net')]",
						"sslState": "Disabled",
						"hostType": "Standard"
					},
					{
						"name": "[concat(variables('appServiceName'), '.scm.azurewebsites.net')]",
						"sslState": "Disabled",
						"hostType": "Repository"
					}
				],
				"serverFarmId": "[resourceId('Microsoft.Web/serverfarms', variables('appServicePlanName'))]",
				"reserved": false,
				"isXenon": false,
				"hyperV": false,
				"scmSiteAlsoStopped": false,
				"clientAffinityEnabled": true,
				"clientCertEnabled": false,
				"hostNamesDisabled": false,
				"containerSize": 0,
				"dailyMemoryTimeQuota": 0,
				"httpsOnly": true,
				"redundancyMode": "None"
			},
			"identity": {
				"type": "SystemAssigned"
			},
			"resources": [
				{
					"type": "Microsoft.Web/sites/config",
					"apiVersion": "2023-12-01",
					"name": "[concat(variables('appServiceName'), '/web')]",
					"location": "[parameters('Location')]",
					"dependsOn": [
						"[variables('appServiceName')]"
					],
					"properties": {
						"numberOfWorkers": 1,
						"defaultDocuments": [
							"Default.htm",
							"Default.html",
							"Default.asp",
							"index.htm",
							"index.html",
							"iisstart.htm",
							"default.aspx",
							"index.php",
							"hostingstart.html"
						],
						"netFrameworkVersion": "v4.0",
						"requestTracingEnabled": false,
						"remoteDebuggingEnabled": false,
						"remoteDebuggingVersion": "VS2019",
						"httpLoggingEnabled": false,
						"logsDirectorySizeLimit": 35,
						"detailedErrorLoggingEnabled": false,
						"publishingUsername": "$KeithDrewNet",
						"scmType": "VSTSRM",
						"use32BitWorkerProcess": true,
						"webSocketsEnabled": false,
						"alwaysOn": true,
						"managedPipelineMode": "Integrated",
						"virtualApplications": [
							{
								"virtualPath": "/",
								"physicalPath": "site\\wwwroot",
								"preloadEnabled": true
							}
						],
						"loadBalancing": "LeastRequests",
						"autoHealEnabled": false,
						"localMySqlEnabled": false,
						"ipSecurityRestrictions": [
							{
								"ipAddress": "Any",
								"action": "Allow",
								"priority": 1,
								"name": "Allow all",
								"description": "Allow all access"
							}
						],
						"scmIpSecurityRestrictions": [
							{
								"ipAddress": "Any",
								"action": "Allow",
								"priority": 1,
								"name": "Allow all",
								"description": "Allow all access"
							}
						],
						"scmIpSecurityRestrictionsUseMain": false,
						"http20Enabled": false,
						"minTlsVersion": "1.2",
						"ftpsState": "Disabled"
					}
				},
				{
					"name": "[concat(variables('appServiceName'), '/appsettings')]",
					"type": "Microsoft.Web/sites/config",
					"apiVersion": "2023-12-01",
					"dependsOn": [
						"[variables('appServiceName')]"
					],
					"properties": {
						"APPINSIGHTS_INSTRUMENTATIONKEY": "[reference(resourceId('Microsoft.Insights/components', variables('applicationInsightsName')), '2020-02-02').InstrumentationKey]",
						"APPLICATIONINSIGHTS_CONNECTION_STRING": "[concat('InstrumentationKey=', reference(resourceId('Microsoft.Insights/components', variables('applicationInsightsName')), '2020-02-02').InstrumentationKey, ';IngestionEndpoint=https://uksouth-0.in.applicationinsights.azure.com/')]",
						"ApplicationInsightsAgent_EXTENSION_VERSION": "~2",
						"XDT_MicrosoftApplicationInsights_Mode": "recommended",
						"APPINSIGHTS_PROFILERFEATURE_VERSION": "1.0.0",
						"DiagnosticServices_EXTENSION_VERSION": "~3",
						"APPINSIGHTS_SNAPSHOTFEATURE_VERSION": "1.0.0",
						"SnapshotDebugger_EXTENSION_VERSION": "disabled",
						"InstrumentationEngine_EXTENSION_VERSION": "disabled",
						"XDT_MicrosoftApplicationInsights_BaseExtensions": "disabled",
						"XDT_MicrosoftApplicationInsights_PreemptSdk": "disabled",
						"XDT_MicrosoftApplicationInsights_Java": "1",
						"XDT_MicrosoftApplicationInsights_NodeJS": "1"
					}
				},
				{
					"type": "Microsoft.Web/sites/hostNameBindings",
					"apiVersion": "2023-12-01",
					"name": "[concat(variables('appServiceName'), '/', variables('appServiceName'), '.azurewebsites.net')]",
					"location": "[parameters('Location')]",
					"dependsOn": [
						"[variables('appServiceName')]"
					],
					"properties": {
						"siteName": "[variables('appServiceName')]",
						"hostNameType": "Verified"
					}
				}
			]
		}
	]
}
